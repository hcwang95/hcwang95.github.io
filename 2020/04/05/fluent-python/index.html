<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hcwang95.github.io","root":"/","scheme":"Mist","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Notes Check the major difference between Python2 and Python3 at What’s New in Python 3.0  Views And Iterators Instead Of Lists PEP 238 Changing the behavior of division All text is Unicode   REPL(">
<meta property="og:type" content="article">
<meta property="og:title" content="fluent-python">
<meta property="og:url" content="http://hcwang95.github.io/2020/04/05/fluent-python/index.html">
<meta property="og:site_name" content="hcwang">
<meta property="og:description" content="Notes Check the major difference between Python2 and Python3 at What’s New in Python 3.0  Views And Iterators Instead Of Lists PEP 238 Changing the behavior of division All text is Unicode   REPL(">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-04-05T20:41:16.000Z">
<meta property="article:modified_time" content="2020-09-20T15:31:26.759Z">
<meta property="article:author" content="Haicheng Wang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://hcwang95.github.io/2020/04/05/fluent-python/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en-us'
  };
</script>

  <title>fluent-python | hcwang</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">hcwang</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Down to the earth</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en-us">
    <link itemprop="mainEntityOfPage" href="http://hcwang95.github.io/2020/04/05/fluent-python/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/14937480?s=400&u=aa3adef3e27c09776dff1a941588ddd3888809a5&v=4">
      <meta itemprop="name" content="Haicheng Wang">
      <meta itemprop="description" content="Down to the earth">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hcwang">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          fluent-python
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: Apr 5th 2020 16:41:16" itemprop="dateCreated datePublished" datetime="2020-04-05T16:41:16-04:00">Apr 5th 2020</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: Sep 20th 2020 11:31:26" itemprop="dateModified" datetime="2020-09-20T11:31:26-04:00">Sep 20th 2020</time>
              </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <a id="more"></a>



<h2 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h2><ol>
<li><p>Check the major difference between Python2 and Python3 at <a href="https://docs.python.org/3.0/whatsnew/3.0.html" target="_blank" rel="noopener">What’s New in Python 3.0</a></p>
<ul>
<li><strong>Views And Iterators</strong> Instead Of Lists</li>
<li><a href="https://www.python.org/dev/peps/pep-0238/" target="_blank" rel="noopener">PEP 238</a> Changing the behavior of division</li>
<li>All text is Unicode</li>
</ul>
</li>
<li><p>REPL(read-eval-print-loop), <a href="https://docs.python.org/3/library/doctest.html" target="_blank" rel="noopener">Doctesting</a>.  Writing tests first as TDD suggests.</p>
</li>
<li><p>“dunder methods”: double under function, i.e. <code>__getitem__</code>.</p>
</li>
<li><p>Use of <code>collections.namedtuple</code> to construct a simple class to represent individual cards.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Card = collections.namedtuple(<span class="string">'Card'</span>, [<span class="string">'rank'</span>, <span class="string">'suit'</span>])</span><br></pre></td></tr></table></figure>


</li>
</ol>
<h2 id="Python-Data-Models"><a href="#Python-Data-Models" class="headerlink" title="Python Data Models"></a>Python Data Models</h2><ol>
<li><code>len(some_object)</code> rather than <code>some_object.len()</code>.</li>
<li>Implement <code>__getitem__</code> to make an object iterable, then usable for some standard libraries! </li>
<li>CPython interpreter will call <code>__len__</code> function for user-defined class, but will take a shortcut by getting <code>ob_size</code> in the <code>PyVarObjectC</code> for built-in objects like <code>list</code>, <code>str</code>, etc.</li>
<li>Avoid creating arbitrary, custom attributes with the <code>__foo__</code> syntax because such names<br>may acquire special meanings in the future, even if they are unused today.</li>
<li>If we did not implement <code>__repr__</code>, vector instances would<br>be shown in the console like <code>&lt;Vector object at 0x10e100070&gt;</code>. The string returned by <code>__repr__</code> should be unambiguous and, if possible, match the<br>source code necessary to recreate the object being represented. </li>
<li><code>__str__</code> should return a string suitable for display<br>to end-users. Check <a href="https://stackoverflow.com/questions/1436703/difference-between-str-and-repr" target="_blank" rel="noopener">difference between <code>__str__</code> and <code>__repr__</code></a>.</li>
<li>By default, instances of user-defined classes are considered truthy, unless either<br><code>__bool__</code> or <code>__len__</code> is implemented.</li>
</ol>
<h2 id="Data-structures"><a href="#Data-structures" class="headerlink" title="Data structures"></a>Data structures</h2><h3 id="Array-of-sequences"><a href="#Array-of-sequences" class="headerlink" title="Array of sequences"></a>Array of sequences</h3><ol>
<li><p>Strings, lists, byte sequences, arrays, XML elements and database results share a rich set of common operations including iteration, slicing, sorting and concatenation.</p>
</li>
<li><p><strong>Container</strong> sequences(<code>list</code>, <code>tuple</code> and <code>collections.deque</code>) hold references to the objects they contain, which may be of any type, while <strong>flat</strong> sequences (<code>str</code>,<code>bytes</code>,<code>bytearray</code>, <code>memoryview</code> and <code>array.array</code>) physically store the value of each item within its own memory space, and not as distinct objects.</p>
</li>
<li><p><strong>Mutable sequences</strong>:<br><code>list</code>,<code>bytearray</code>, <code>array.array</code>, <code>collections.deque</code> and <code>memory</code>; <strong>Immutable sequences</strong>:<br><code>tuple</code>, <code>str</code> and<code>bytes</code></p>
</li>
<li><p>List comprehension = <em>listcomp</em>, generator expression = <em>genexprs</em>.</p>
</li>
<li><p><strong>Only</strong> do <em>listcomp</em> when you create a list, others should use for loop for more readable and less undetected side-effects.</p>
</li>
<li><p>In Python code, line breaks are ignored inside pairs of <code>[]</code>, <code>{}</code> or <code>()</code>.<br>So you can build multi-line lists, listcomps, genexps, dictionaries etc.<br>without using the ugly <code>\</code> line continuation escape.</p>
</li>
<li><p>Use tuple as records, where the position is vital for the meaning of records.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">traveler_ids = [(<span class="string">'USA'</span>, <span class="string">'31195855'</span>), (<span class="string">'BRA'</span>, <span class="string">'CE342567'</span>),</span><br><span class="line"><span class="meta">... </span>(<span class="string">'ESP'</span>, <span class="string">'XDA205856'</span>)]</span><br></pre></td></tr></table></figure></li>
<li><p>Unpacking. Tuple unpacking is widely used in Python. But Python also provides <a href="https://www.python.org/dev/peps/pep-3132/" target="_blank" rel="noopener">Extended Iterable Unpacking</a>, where we use <code>*</code> to grab excess items.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a, b, *rest = range(<span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a, b, rest</span><br><span class="line">(<span class="number">0</span>, <span class="number">1</span>, [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a, b, *rest = range(<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a, b, rest</span><br><span class="line">(<span class="number">0</span>, <span class="number">1</span>, [<span class="number">2</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a, b, *rest = range(<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a, b, rest</span><br><span class="line">(<span class="number">0</span>, <span class="number">1</span>, [])</span><br></pre></td></tr></table></figure></li>
<li><p>Nested tuple unpacking: The tuple to receive an expression to unpack can have nested tuples, like <code>(a, b, (c, d))</code> and Python will do the right thing if the expression matches the nesting structure. </p>
</li>
<li><p>Named tuples: The <code>collections.namedtuple</code> function is a factory that produces subclasses of tuple<br>enhanced with field names and a class name — which helps debugging</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>City = namedtuple(<span class="string">'City'</span>, <span class="string">'name country population coordinates'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tokyo = City(<span class="string">'Tokyo'</span>, <span class="string">'JP'</span>, <span class="number">36.933</span>, (<span class="number">35.689722</span>, <span class="number">139.691667</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tokyo</span><br><span class="line">City(name=<span class="string">'Tokyo'</span>, country=<span class="string">'JP'</span>, population=<span class="number">36.933</span>, coordinates=(<span class="number">35.689722</span>, <span class="number">139.691667</span>))</span><br></pre></td></tr></table></figure>
<p>Other attributes of namedtuple, <code>fields</code>, <code>make</code>, <code>asdict</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>City._fields</span><br><span class="line">(<span class="string">'name'</span>, <span class="string">'country'</span>, <span class="string">'population'</span>, <span class="string">'coordinates'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>LatLong = namedtuple(<span class="string">'LatLong'</span>, <span class="string">'lat long'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>delhi_data = (<span class="string">'Delhi NCR'</span>, <span class="string">'IN'</span>, <span class="number">21.935</span>, LatLong(<span class="number">28.613889</span>, <span class="number">77.208889</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>delhi = City._make(delhi_data)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>delhi._asdict()</span><br><span class="line">OrderedDict([(<span class="string">'name'</span>, <span class="string">'Delhi NCR'</span>), (<span class="string">'country'</span>, <span class="string">'IN'</span>), (<span class="string">'population'</span>,</span><br><span class="line"><span class="number">21.935</span>), (<span class="string">'coordinates'</span>, LatLong(lat=<span class="number">28.613889</span>, long=<span class="number">77.208889</span>))])</span><br></pre></td></tr></table></figure></li>
<li><p>Slice Object: <code>slice(start, end, step)</code> can be used to get sliced sequences from list, most importantly, we can define the slicing based by a name. </p>
</li>
<li><p>Assigning to slice will replace the corresponding sequences defined by the slice. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = list(range(<span class="number">10</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l[<span class="number">2</span>:<span class="number">5</span>] = [<span class="number">20</span>, <span class="number">30</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> l[<span class="number">5</span>:<span class="number">7</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l[<span class="number">3</span>::<span class="number">2</span>] = [<span class="number">11</span>, <span class="number">22</span>]</span><br></pre></td></tr></table></figure></li>
<li><p>Beware of expressions like <code>a * n</code> when <code>a</code> is a sequence containing mutable items.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = [[<span class="number">1</span>], [<span class="number">2</span>], [<span class="number">3</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = l * <span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b[<span class="number">2</span>][<span class="number">0</span>] = <span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br><span class="line">[[<span class="number">1</span>], [<span class="number">2</span>], [<span class="number">10</span>], [<span class="number">1</span>], [<span class="number">2</span>], [<span class="number">10</span>], [<span class="number">1</span>], [<span class="number">2</span>], [<span class="number">10</span>], [<span class="number">1</span>], [<span class="number">2</span>], [<span class="number">10</span>], [<span class="number">1</span>], [<span class="number">2</span>], [<span class="number">10</span>]]</span><br></pre></td></tr></table></figure>
</li>
<li><p>Something wierd from list inside tuple, see the example below,</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = (<span class="number">1</span>, <span class="number">2</span>, [<span class="number">30</span>, <span class="number">40</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t[<span class="number">2</span>] += [<span class="number">50</span>, <span class="number">60</span>]</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: <span class="string">'tuple'</span> object does <span class="keyword">not</span> support item assignment</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, [<span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>, <span class="number">60</span>])</span><br></pre></td></tr></table></figure>
<p>Takeaway from the example:</p>
</li>
</ol>
<ul>
<li>Putting mutable items in tuples is not a good idea.</li>
<li>Augmented assignment is not an atomic operation — we just saw it throwing an exception after doing part of its job.</li>
</ul>
<ol start="15">
<li><p><strong>Python API convention</strong>: functions or methods that change an object in-place should return <code>None</code> to make it clear to the caller that the object itself was changed, and no new object was created.</p>
</li>
<li><p>Because of returning None, Python is not naturally support fluenct interface. A <a href="https://en.wikipedia.org/wiki/Fluent_interface" target="_blank" rel="noopener"><strong>fluent interface</strong></a> is normally implemented by using method chaining to implement method cascading (in languages that do not natively support cascading), concretely by having each method return <code>this (self)</code>.</p>
</li>
<li><p><code>bisect.insort</code>: inserts <code>item</code> into <code>seq</code> so as to keep <code>seq</code> in ascending order.</p>
</li>
<li><p><code>array.array</code> is better than <code>list</code> when all items in the sequence are numbers. The <code>array</code> is actually C array, and supports all mutable sequence operations (<code>pop</code>, <code>insert</code>, <code>extend</code>), also supports additional write and read function (<code>fromfile</code>, <code>tofile</code>). Notably, the <code>fromfile</code> function reading 10 million floating number is 60 times faster than reading numbers from <code>txt</code> file since it write and read to binary file(also 50-60% smaller than <code>txt</code> file).</p>
</li>
<li><p>Memory views: the built-in <code>memorview</code> is a shared-memory sequence type that lets you handle<br>slices of arrays without copying bytes. It is inspired by <code>NumPy</code> library. It is useful when dealing with large dataset.</p>
</li>
<li><p><code>deque</code>: double ended queue, optimized for modifying element from both ends. <code>queue</code> provides the synchronized (i.e. thread-safe) classes <code>Queue</code>, <code>LifoQueue</code> and <code>PriorityQueue</code>. These are used for safe communication between threads.</p>
</li>
<li><p><code>multiprocessing</code> package has its own queue but designed for inter-process communication, <code>asyncio</code> also implements similar queues which are adapted for managing task in asynchronous programming.</p>
</li>
</ol>
<h3 id="Dictionaries-and-Sets"><a href="#Dictionaries-and-Sets" class="headerlink" title="Dictionaries and Sets"></a>Dictionaries and Sets</h3><ol>
<li>Dictionaries are everywhere in Python. The built-in functions live in <code>__builtins__.__dict__</code>.</li>
<li>The key must be <strong>hashable</strong> in dictionary, which implements <code>__hash__</code> method. The atomic immutable types (<code>str</code>, <code>bytes</code>, numeric types) are all hashable. A <code>frozen set</code>(builtin set type which cannot be changed after created) is always hashable, because its elements must be hashable by definition. A tuple is hashable only if all its items are hashable.</li>
<li><strong>dict comprehension</strong> - <em>dictcomp</em>: builds a dict instance by producing <code>key:value</code> pair from any iterable</li>
<li>Every Pythonista knows that d.get(k, default) is an alternative to <code>d[k]</code> whenever a default value is more convenient than handling <code>KeyError</code>. However I didn’t konw that before read the paragraph…</li>
<li><code>setdefault</code>:<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">my_dict.setdefault(key, []).append(new_value)</span><br><span class="line"><span class="comment"># is equvalent to </span></span><br><span class="line"><span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> my_dict:</span><br><span class="line">    my_dict[key] = []</span><br><span class="line">my_dict[key].append(new_value)</span><br></pre></td></tr></table></figure></li>
<li>Using <code>defaultdict</code> or another mapping implemented with <code>__missing__</code>, to properly handle the missing key in lookup.</li>
<li>A search like <code>k in my_dict.keys()</code> is efficient in Python 3 even for very large mappings because dict.keys() returns a view, which is similar to a set, and containment checks in sets are as fast as in dicts. Check <a href="https://stackoverflow.com/questions/8957750/what-are-dictionary-view-objects/8960727#8960727" target="_blank" rel="noopener">this</a> for explanations about <strong>dictionary view</strong>.</li>
<li>Other types of mapping (dict): <code>collections.OrderedDict</code>: maintains keys in insertion order, allowing iteration over items in a predictable order; <code>collections.OrderedDict</code>: holds a list of mappings which can be searched as one. The lookup is performed on<br>each mapping in order, and succeeds if the key is found in any of them. <code>collections.Counter</code>: a mapping that holds an integer count for each key; <code>collections.UserDict</code>:  a pure Python implementation of a mapping that works like a standard dict, ususally desiged to be <strong>subclassed</strong>.</li>
<li>We should subclass <code>UserDict</code> rather than bulit-in <code>dict</code>, because there are shortcuts implementations that may cause problem. Here is the comparison for designing a new dictionary class with <code>UserDict</code> and <code>dict</code>: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StrKeyDict0</span><span class="params">(dict)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__missing__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(key, str):</span><br><span class="line">            <span class="keyword">raise</span> KeyError(key)</span><br><span class="line">        <span class="keyword">return</span> self[str(key)]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, key, default=None)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self[key]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">return</span> default</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__contains__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> key <span class="keyword">in</span> self.keys() <span class="keyword">or</span> str(key) <span class="keyword">in</span> self.keys()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StrKeyDict</span><span class="params">(collections.UserDict)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__missing__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(key, str):</span><br><span class="line">            <span class="keyword">raise</span> KeyError(key)</span><br><span class="line">        <span class="keyword">return</span> self[str(key)]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__contains__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(key) <span class="keyword">in</span> self.data</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, item)</span>:</span></span><br><span class="line">        self.data[str(key)] = item</span><br></pre></td></tr></table></figure></li>
<li>Use <code>type.MappingProxyType</code> could generate a <strong>read-only</strong> but dynamic view of a dictionary, which prevents uncautious update of a dictionary. </li>
<li><code>Set</code> class implements some infix operations <strong>union, intersection and difference etc.</strong>, which could be used to reduce the loop thus the running time: here is an exaple to check the occurence of <em>needles</em> in *haystack: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">found = len(needles &amp; haystack)</span><br></pre></td></tr></table></figure></li>
<li><code>set comprehension</code> similar to list / dict comprehension.</li>
<li>The hashtable used by <code>dict</code> and <code>set</code> are powerful and should achieve constant key searching / retrieving time, also in practice it might be always constant, for example the memeory cannot fit the whole data, then <strong>memory fetching time</strong> may increase w.r.t. the size of data.</li>
<li>Implementation of hashtable used by Python: a sparse array of cells/buckets, each cell contains the reference to key and value. Python tries to keep at least <strong>1/3</strong> cells are empty.</li>
<li>due to the hash table implementation, <strong>adding items to a dict/set may change the order of existing keys</strong>. So DO NOT modifying contents while iterating through it in the context of <code>dict</code> and <code>set</code>.</li>
</ol>
<h3 id="Text-and-bytes"><a href="#Text-and-bytes" class="headerlink" title="Text and bytes"></a>Text and bytes</h3><ol>
<li><p><code>str</code> is sequence of characters, while <em>characters</em> may have different definition and may lead to problem if not properly handled.</p>
</li>
<li><p>The actual bytes that represent a character depend on the encoding in use. From <strong>code point</strong> of the character to byte representation is encoder, the reverse is decoding. The byte representation is used for storage and transmission, while <code>str</code> is for human readability.</p>
</li>
<li><p><code>UnicodeEncodeError</code> usually associates with source string having characters cannot be mapped to byte sequence with specified encoder.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>city = <span class="string">'São Paulo'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>city.encode(<span class="string">'utf_8'</span>)</span><br><span class="line"><span class="string">b'S\xc3\xa3o Paulo'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>city.encode(<span class="string">'utf_16'</span>)</span><br><span class="line"><span class="string">b'\xff\xfeS\x00\xe3\x00o\x00 \x00P\x00a\x00u\x00l\x00o\x00'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>city.encode(<span class="string">'iso8859_1'</span>)</span><br><span class="line"><span class="string">b'S\xe3o Paulo'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>city.encode(<span class="string">'cp437'</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">File <span class="string">"/.../lib/python3.4/encodings/cp437.py"</span>, line <span class="number">12</span>, <span class="keyword">in</span> encode</span><br><span class="line"><span class="keyword">return</span> codecs.charmap_encode(input,errors,encoding_map)</span><br><span class="line">UnicodeEncodeError: <span class="string">'charmap'</span> codec can<span class="string">'t encode character '</span>\xe3<span class="string">' in</span></span><br><span class="line"><span class="string">position 1: character maps to &lt;undefined&gt;</span></span><br><span class="line"><span class="string">&gt;&gt;&gt; city.encode('</span>cp437<span class="string">', errors='</span>ignore<span class="string">')</span></span><br><span class="line"><span class="string">b'</span>So Paulo<span class="string">'</span></span><br><span class="line"><span class="string">&gt;&gt;&gt; city.encode('</span>cp437<span class="string">', errors='</span>replace<span class="string">')</span></span><br><span class="line">b'S?o Paulo'</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>city.encode(<span class="string">'cp437'</span>, errors=<span class="string">'xmlcharrefreplace'</span>)</span><br><span class="line"><span class="string">b'S&amp;#227;o Paulo'</span></span><br></pre></td></tr></table></figure>
<p><code>UnicodeDecodeError</code> occurs when byte sequneces cannot be recoginized by specified decoder.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>octets = <span class="string">b'Montr\xe9al'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>octets.decode(<span class="string">'cp1252'</span>)</span><br><span class="line"><span class="string">'Montréal'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>octets.decode(<span class="string">'iso8859_7'</span>)</span><br><span class="line"><span class="string">'Montrιal'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>octets.decode(<span class="string">'koi8_r'</span>)</span><br><span class="line"><span class="string">'MontrИal</span></span><br><span class="line"><span class="string">&gt;&gt;&gt; octets.decode('</span>utf_8<span class="string">')</span></span><br><span class="line"><span class="string">Traceback (most recent call last):</span></span><br><span class="line"><span class="string">File "&lt;stdin&gt;", line 1, in &lt;module&gt;</span></span><br><span class="line"><span class="string">UnicodeDecodeError: '</span>utf<span class="number">-8</span><span class="string">' codec can'</span>t decode byte <span class="number">0xe9</span> <span class="keyword">in</span> position <span class="number">5</span>:</span><br><span class="line">invalid continuation byte</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>octets.decode(<span class="string">'utf_8'</span>, errors=<span class="string">'replace'</span>)</span><br><span class="line"><span class="string">'Montr�al</span></span><br></pre></td></tr></table></figure>
<p><code>SyntaxError</code> occurs when the source Python file contains non UTF8 (default codecs for Python) chars.</p>
</li>
<li><p>When you are not sure about the string codecs, use <a href="https://pypi.org/project/chardet/" target="_blank" rel="noopener"><code>chardet</code></a> to detect.</p>
</li>
<li><p><strong>Unicode sandwich</strong> as the best practice of text processing. (1) read and encode text from bytes to <code>str</code>; (2) processing in <code>str</code>， (3) decode to byte sequence and store back.</p>
</li>
<li><p>Garbled chars occurs when you read file with wrong decoder, ususally windows having its default “Windows 1252” will not compatible with some chars in UTF8.</p>
</li>
<li><p>Be careful between the codecs default in Unix and Windows system. check <code>locale.getpreferredencoding()</code> for the default encoding. </p>
</li>
<li><p><code>os</code> and <code>re</code> packages could take <code>str</code> and <code>bytes</code> as arguments, with corresponding different handling stategies. Be careful about the type before passing it to those functions in <code>os</code> and <code>re</code>. </p>
</li>
</ol>
<h2 id="Functions-as-objects"><a href="#Functions-as-objects" class="headerlink" title="Functions as objects"></a>Functions as objects</h2><h3 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h3><ol>
<li>Functions in Python are first-class objects (i.e. integers, strings and dictionaries). Programming language theorists define a <code>first-class object</code> as a program entity that can be:</li>
</ol>
<ul>
<li>created at runtime;</li>
<li>assigned to a variable or element in a data structure;</li>
<li>passed as an argument to a function;</li>
<li>returned as the result of a function.</li>
</ul>
<ol start="2">
<li><p><strong>Higher order functions</strong>: takes a function as argument or returns a function as a results. For example the function <code>sorted</code> is an example.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sorted takes a function len as argument</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fruits = [<span class="string">'strawberry'</span>, <span class="string">'fig'</span>, <span class="string">'apple'</span>, <span class="string">'cherry'</span>, <span class="string">'raspberry'</span>, <span class="string">'banana'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(fruits, key=len)</span><br><span class="line">[<span class="string">'fig'</span>, <span class="string">'apple'</span>, <span class="string">'cherry'</span>, <span class="string">'banana'</span>, <span class="string">'raspberry'</span>, <span class="string">'strawberry'</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>In the functional programming paradigm, some of the best known higher-order functions are <code>map</code>, <code>filter</code>, <code>reduce</code> and <code>apply</code>. <code>apply</code> is deprecated and not used after Python3. And for other functions there are many better alternatives for most of their use cases.</p>
</li>
<li><p><code>map</code> and <code>filter</code> can be replaced by <code>listcomp</code> and <code>genexpr</code> since they are more readable, sometimes more faster according to the <a href="https://stackoverflow.com/a/1247490" target="_blank" rel="noopener">link</a> (also there are many good explanations of the difference between <code>map</code> v.s. <code>listcomp</code>).</p>
</li>
<li><p>The best use of anonymous functions is in the context of an argument list. Otherwise it is better to used the normal function definition. Check <a href="https://docs.python.org/3/howto/functional.html#small-functions-and-the-lambda-expression" target="_blank" rel="noopener">here</a> for the refactor tips for bad lambda functions in Python.</p>
</li>
<li><p>Python3 proivdes pretty flexible arguments passing to a function, check <a href="https://stackoverflow.com/a/36908" target="_blank" rel="noopener">here</a> for more information. Official explanation is introduced by <a href="https://www.python.org/dev/peps/pep-3102/" target="_blank" rel="noopener">PEP 3102</a>. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># understand more about how to right functions with variable positional arguments and keyword argument</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(a, *pargs, **kargs)</span>:</span></span><br><span class="line"><span class="meta">... </span>    print(a, pargs, kargs)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, x=<span class="number">4</span>, y=<span class="number">5</span>)</span><br><span class="line"><span class="number">1</span> (<span class="number">2</span>, <span class="number">3</span>) &#123;<span class="string">'x'</span>: <span class="number">4</span>, <span class="string">'y'</span>: <span class="number">5</span>&#125; <span class="comment"># the arguments are parsed to assign to different argument in the signature of the function</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f_1</span><span class="params">(a, *pargs, **kargs)</span>:</span></span><br><span class="line"><span class="meta">... </span>    print(a, pargs, kargs)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, x=<span class="number">4</span>, x=<span class="number">5</span>)</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span></span><br><span class="line">SyntaxError: keyword argument repeated <span class="comment"># cannot parse duplicated keyword arguments</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, x=<span class="number">4</span>, y=<span class="number">5</span>, <span class="number">10</span>)</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span></span><br><span class="line">SyntaxError: positional argument follows keyword argument</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(a,  **kargs, *pargs)</span>:</span></span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(a,  **kargs, *pargs)</span>:</span></span><br><span class="line">                       ^</span><br><span class="line">SyntaxError: invalid syntax <span class="comment"># cannot create positional arguments after keyword arguments.</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Function annotations</strong>: Python 3 provides syntax to attach metadata to the parameters of a function declaration<br>and its return value. Here is an example, the only difference is its sigature in the declaration.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clip</span><span class="params">(text, max_len:=<span class="number">80</span>)</span>:</span> <span class="comment"># without annotations</span></span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clip</span><span class="params">(text:str, max_len:<span class="string">'int &gt; 0'</span>=<span class="number">80</span>)</span> -&gt; str:</span> <span class="comment"># with annotations</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>clip.__annotations__</span><br><span class="line">&#123;'text': &lt;class 'str'&gt;, 'max_len': 'int &gt; 0', 'return': &lt;class 'str'&gt;&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>Note</strong>: The only thing Python does with annotations is to store them in the <code>__annotations__</code> attribute of the function. Nothing else: <strong>no checks, enforcement, validation, or any other action is performed</strong>. They are just metadata that <strong>may</strong> be used by tools, such as IDEs, frameworks and decorators. </p>
<ol start="8">
<li><code>operator</code> module implements many common functions that needed in functional programming, for example <code>mul</code> == <code>lambda a, b: a*b</code>, also <code>itemgetter</code> which helps you to get subitem from the item which can retrieve item by index (implements <code>__getitem__</code>), <code>attrgetter</code> can get values by keyword(s) from an item having mapping. Some functions supported by <code>operator</code> can be found in the following:<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[name <span class="keyword">for</span> name <span class="keyword">in</span> dir(operator) <span class="keyword">if</span> <span class="keyword">not</span> name.startswith(<span class="string">'_'</span>)]</span><br><span class="line">[<span class="string">'abs'</span>, <span class="string">'add'</span>, <span class="string">'and_'</span>, <span class="string">'attrgetter'</span>, <span class="string">'concat'</span>, <span class="string">'contains'</span>,</span><br><span class="line"><span class="string">'countOf'</span>, <span class="string">'delitem'</span>, <span class="string">'eq'</span>, <span class="string">'floordiv'</span>, <span class="string">'ge'</span>, <span class="string">'getitem'</span>, <span class="string">'gt'</span>,</span><br><span class="line"><span class="string">'iadd'</span>, <span class="string">'iand'</span>, <span class="string">'iconcat'</span>, <span class="string">'ifloordiv'</span>, <span class="string">'ilshift'</span>, <span class="string">'imod'</span>, <span class="string">'imul'</span>, <span class="string">'index'</span>, <span class="string">'indexOf'</span>, <span class="string">'inv'</span>, <span class="string">'invert'</span>, <span class="string">'ior'</span>, <span class="string">'ipow'</span>, <span class="string">'irshift'</span>, <span class="string">'is_'</span>, <span class="string">'is_not'</span>, <span class="string">'isub'</span>, <span class="string">'itemgetter'</span>, <span class="string">'itruediv'</span>, <span class="string">'ixor'</span>, <span class="string">'le'</span>, <span class="string">'length_hint'</span>, <span class="string">'lshift'</span>, <span class="string">'lt'</span>, <span class="string">'methodcaller'</span>, <span class="string">'mod'</span>, <span class="string">'mul'</span>, <span class="string">'ne'</span>, <span class="string">'neg'</span>, <span class="string">'not_'</span>, <span class="string">'or_'</span>, <span class="string">'pos'</span>, <span class="string">'pow'</span>, <span class="string">'rshift'</span>, <span class="string">'setitem'</span>, <span class="string">'sub'</span>, <span class="string">'truediv'</span>, <span class="string">'truth'</span>, <span class="string">'xor'</span>]</span><br></pre></td></tr></table></figure>
Most of the 52 names above are self-evident. The group of names prefixed with <code>i</code> and<br>the name of another operator — e.g. <code>iadd</code>, <code>iand</code> etc. — correspond to the augmented<br>assignment operators — e.g. <code>+=,</code> <code>&amp;=</code> etc. </li>
</ol>
<p>Also check <code>methodcaller</code> in <code>operator</code> that could create those functions based on other built-in functions.</p>
<ol start="9">
<li><code>functools.partial</code> can create <strong>partial functions</strong> where part of the arguments are freezed compared to the normal functions. Here is an example<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> operator <span class="keyword">import</span> mul</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>triple = partial(mul, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>triple(<span class="number">7</span>)</span><br><span class="line"><span class="number">21</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(map(triple, range(<span class="number">1</span>, <span class="number">10</span>)))</span><br><span class="line">[<span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="number">18</span>, <span class="number">21</span>, <span class="number">24</span>, <span class="number">27</span>]</span><br></pre></td></tr></table></figure>
<code>partial</code> takes a callable as first argument, followed by an arbitrary number of positional<br>and keyword arguments to bind. On a sidenote, <code>partialmethod</code> (introduced from Python 3.4) is same to <code>partial</code> but for class method, refer to <a href="https://stackoverflow.com/a/42844721" target="_blank" rel="noopener">this</a>.</li>
</ol>
<h3 id="Decorators-and-closures"><a href="#Decorators-and-closures" class="headerlink" title="Decorators and closures"></a>Decorators and closures</h3><ol>
<li><p>The first crucial fact about <code>decorators</code> is that they have the power to replace the decorated function with a different one. The second crucial fact is that <strong>they are executed immediately when a module is loaded</strong>.<br>Check the following decorators and prints to understand it better. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># registration.py</span></span><br><span class="line">registry = []</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(func)</span>:</span></span><br><span class="line">    print(<span class="string">'running register(%s)'</span> % func)</span><br><span class="line">    registry.append(func)</span><br><span class="line">    <span class="keyword">return</span> func</span><br><span class="line"><span class="meta">@register</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'running f1()'</span>)</span><br><span class="line"><span class="meta">@register</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'running f2()'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'running f3()'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'running main()'</span>)</span><br><span class="line">    print(<span class="string">'registry -&gt;'</span>, registry)</span><br><span class="line">    f1()</span><br><span class="line">    f2()</span><br><span class="line">    f3()</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"><span class="comment">## running this as a python file</span></span><br><span class="line">$ python3 registration.py</span><br><span class="line">running register(&lt;function f1 at <span class="number">0x100631bf8</span>&gt;)</span><br><span class="line">running register(&lt;function f2 at <span class="number">0x100631c80</span>&gt;)</span><br><span class="line">running main()</span><br><span class="line">registry -&gt; [&lt;function f1 at 0x100631bf8&gt;, &lt;function f2 at 0x100631c80&gt;]</span><br><span class="line">running f1()</span><br><span class="line">running f2()</span><br><span class="line">running f3()</span><br></pre></td></tr></table></figure></li>
<li><p><strong>Closure</strong>: similar to the meaning applied to other programming languages, the closure is reachability of an local variable. Consider the following decorator example:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_averager</span><span class="params">()</span>:</span></span><br><span class="line">    series = []</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">averager</span><span class="params">(new_value)</span>:</span></span><br><span class="line">        series.append(new_value)</span><br><span class="line">        total = sum(series)</span><br><span class="line">        <span class="keyword">return</span> total/len(series)</span><br><span class="line">    <span class="keyword">return</span> averager</span><br><span class="line"><span class="comment"># load the module and run     </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg = make_averager()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg(<span class="number">10</span>)</span><br><span class="line"><span class="number">10.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg(<span class="number">11</span>)</span><br><span class="line"><span class="number">10.5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg(<span class="number">12</span>)</span><br><span class="line"><span class="number">11.0</span></span><br></pre></td></tr></table></figure>
<p>Where <code>series</code> is a <strong>free variable</strong> (variable that is not bound in the local scope). Although we could not find in the local scope, the <code>series</code> is bound and kept in the <code>__closure___</code> attribute of the returned function <code>avg</code>.<br>Here is how we could find the free variable (continued from last code block). </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg.__code__.co_varnames</span><br><span class="line">(<span class="string">'new_value'</span>, <span class="string">'total'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg.__code__.co_freevars</span><br><span class="line">(<span class="string">'series'</span>,)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg.__closure__</span><br><span class="line">(&lt;cell at <span class="number">0x107a44f78</span>: list object at <span class="number">0x107a91a48</span>&gt;,)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg.__closure__[<span class="number">0</span>].cell_contents</span><br><span class="line">[<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]</span><br></pre></td></tr></table></figure>
<p>To make it easier, we only need to deal with those “external variables” <strong>when we define a function nested in another function</strong>. </p>
</li>
<li><p><code>nonlocal</code> is used to keep immutable free variables not changed to local even if there is an assignment in the local scope. Here is a function which give the same output with the previous <code>averager</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_averager</span><span class="params">()</span>:</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    total = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">averager</span><span class="params">(new_value)</span>:</span></span><br><span class="line">        <span class="keyword">nonlocal</span> count, total <span class="comment"># without this line assignment error will occur because count will be update to be a local variable</span></span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        total += new_value</span><br><span class="line">        <span class="keyword">return</span> total / count</span><br><span class="line">    <span class="keyword">return</span> averager</span><br></pre></td></tr></table></figure>
</li>
<li><p>A draw back for a simple decorator is that it will mask the <code>__name__</code> and <code>__doc__</code> of the decorated functions. We could use <code>functools.wraps</code> to copy those information to the decorated return function. </p>
</li>
<li><p>Check <code>singledispatch</code> decorator at <a href="https://www.python.org/dev/peps/pep-0443/" target="_blank" rel="noopener">here</a>.</p>
</li>
</ol>
<ol start="6">
<li><p><strong>stacked decorators</strong> applied from inner to outer:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@d1</span></span><br><span class="line"><span class="meta">@d2</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># is the same as </span></span><br><span class="line">f = d1(d2(f))</span><br></pre></td></tr></table></figure></li>
<li><p>Use <strong>decorator factory method</strong> could let the decorator accept other arguments, note that the factory method return the decorator rather than the inner function defined inside the decorator. Samples: </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">registry = set()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(active=True)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorate</span><span class="params">(func)</span>:</span></span><br><span class="line">        print(<span class="string">'running register(active=%s)-&gt;decorate(%s)'</span></span><br><span class="line">            % (active, func))</span><br><span class="line">        <span class="keyword">if</span> active:</span><br><span class="line">            registry.add(func)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            registry.discard(func)</span><br><span class="line">        <span class="keyword">return</span> func</span><br><span class="line">    <span class="keyword">return</span> decorate</span><br><span class="line"></span><br><span class="line"><span class="meta">@register(active=False)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'running f1()'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@register() </span></span><br><span class="line"><span class="comment"># here we need to add bracket to call register to get real decorator!!</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'running f2()'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Check <a href="https://wiki.python.org/moin/PythonDecoratorLibrary" target="_blank" rel="noopener">Python Decorator Library</a> for more practical examples of decorators.</p>
</li>
</ol>
<h2 id="Object-Oriented-Idioms"><a href="#Object-Oriented-Idioms" class="headerlink" title="Object Oriented Idioms"></a>Object Oriented Idioms</h2><h3 id="Object-references-mutability-recylcing"><a href="#Object-references-mutability-recylcing" class="headerlink" title="Object references, mutability, recylcing"></a>Object references, mutability, recylcing</h3><ol>
<li><p>Python variables are reference to the real object.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = a </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.append(<span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>use <code>is</code> to check object identities are same or not, use <code>==</code> to check the values are equal or not between two objects. <code>is</code> is faster than <code>==</code> because the former cannot be overloaded so Python does not have to find and invoke special methods to evaluate it. Note that <code>==</code> is the syntactic sugar for <code>__eq__</code> function.</p>
</li>
<li><p>Copies are shallow by default: the shallows refers during copy the outermost container get copied but inside elements are not copied. Here is an example</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1 = [<span class="number">3</span>, [<span class="number">55</span>, <span class="number">44</span>], (<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l2 = list(l1)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l2</span><br><span class="line">[<span class="number">3</span>, [<span class="number">55</span>, <span class="number">44</span>], (<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l2 == l1</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l2 <span class="keyword">is</span> l1</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l2[<span class="number">1</span>].append(<span class="number">100</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1</span><br><span class="line">[<span class="number">3</span>, [<span class="number">55</span>, <span class="number">44</span>, <span class="number">100</span>], (<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l2</span><br><span class="line">[<span class="number">3</span>, [<span class="number">55</span>, <span class="number">44</span>, <span class="number">100</span>], (<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>)]</span><br></pre></td></tr></table></figure>
</li>
<li><p>use <code>deepcopy</code> to copy objects which don’t have shared reference to the source objects. Also we could customized copy and deepcopy behavior by implementing <code>__copy__()</code> and <code>__deepcopy__()</code> method according to the <a href="https://docs.python.org/3/library/copy.html" target="_blank" rel="noopener">doc</a>. </p>
</li>
<li><p>The parameter passing in Python is <em>call by sharing</em>: each formal parameter of the function gets a copy of each reference in the arguments. The result of this scheme is that a function may change any <strong>mutable object</strong> passed as a parameter, but it cannot change the <strong>identity</strong> of those objects, i.e. it cannot replace altogether an object with another. Here is an example</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(a, b)</span>:</span></span><br><span class="line"><span class="meta">... </span>    a += b</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> a</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y = <span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f(x, y)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="comment"># x and y does not change because they are int type which is immutable, so changes in function cannot replace x with a new int object.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x, y</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = [<span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f(a, b)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="comment"># the object a does not get changed in identity, but the value are indeed changed.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a, b</span><br><span class="line">([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], [<span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = (<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>u = (<span class="number">30</span>, <span class="number">40</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f(t, u)</span><br><span class="line">(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t, u</span><br><span class="line">((<span class="number">10</span>, <span class="number">20</span>), (<span class="number">30</span>, <span class="number">40</span>))</span><br><span class="line"><span class="comment"># tuple are immutable objects, so the behavior should be the same as int object discussed above.</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Avoid setting the default parameter as mutable object (<code>list</code>, <code>dict</code>, …). Check the example to understand the side effect from it.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HauntedBus</span>:</span></span><br><span class="line">    <span class="string">"""A bus model haunted by ghost passengers"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, passengers=[])</span>:</span></span><br><span class="line">        self.passengers = passengers</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pick</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.passengers.append(name)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">drop</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.passengers.remove(name)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus1 = HauntedBus([<span class="string">'Alice'</span>, <span class="string">'Bill'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus1.passengers</span><br><span class="line">[<span class="string">'Alice'</span>, <span class="string">'Bill'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus1.pick(<span class="string">'Charlie'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus1.drop(<span class="string">'Alice'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus1.passengers</span><br><span class="line">[<span class="string">'Bill'</span>, <span class="string">'Charlie'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus2 = HauntedBus()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus2.pick(<span class="string">'Carrie'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus2.passengers</span><br><span class="line">[<span class="string">'Carrie'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus3 = HauntedBus()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus3.passengers</span><br><span class="line">[<span class="string">'Carrie'</span>]</span><br><span class="line"><span class="comment"># the bus3 acutally shares the passengers list with bus2!!</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus3.pick(<span class="string">'Dave'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus2.passengers</span><br><span class="line">[<span class="string">'Carrie'</span>, <span class="string">'Dave'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus2.passengers <span class="keyword">is</span> bus3.passengers</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus1.passengers</span><br><span class="line">[<span class="string">'Bill'</span>, <span class="string">'Charlie'</span>]</span><br></pre></td></tr></table></figure>
<p>The problem is that each default value is evaluated <strong>when the function is defined — i.e. usually when the module is loaded</strong> — and the default values <strong>become attributes of the function object</strong>. So if a default value is a mutable object, and you change it, the change will affect every future call of the function.</p>
</li>
</ol>
<p>The defensive way to handle the above problem:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, passengers=None)</span>:</span></span><br><span class="line">    <span class="comment"># make default parameter of passengers to be immutable</span></span><br><span class="line">    <span class="keyword">if</span> passengers <span class="keyword">is</span> <span class="literal">None</span>: </span><br><span class="line">        self.passengers = []</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self.passengers = list(passengers)</span><br><span class="line">        <span class="comment"># here do not directly assign passengers passed in to be the field. Becuase in this way `self.passengers` is only the reference to the outside list. We need to create a copy of that list</span></span><br></pre></td></tr></table></figure>

<ol start="7">
<li><p>The <code>del</code> statement deletes names, not objects. An object may be garbage collected as result of a <code>del</code> command, but only if the variable deleted holds the last reference to the<br>object, or if the object becomes unreachable. In CPython the primary algorithm for garbage collection is reference counting. But for other implementations of Python they have more sophisticated garbage collector that do not rely on reference counting. We could use <code>weakref.finalize</code> to register a callback function to be called when an object is destroyed.</p>
</li>
<li><p><strong>Weak references</strong> refers to those references that will not increase the reference count, a low level mechanism underlying the more useful collections <code>WeakValueDictionary</code>, <code>WeakKeyDictionary</code>, <code>WeakSet</code>, and the <code>finalize</code> function from the <code>weakref</code> module are related to some use case of weak references. </p>
</li>
<li><p>Some strings or integers are <strong>interned</strong>, where creating two variables with the same string or integers separately will make two variables references to the same object. However it is mostly dependent on different implementation of Python. But be careful to those common stings and integers: (1)Integers in range(-5, 257), (2) Often-used, single-character, and empty strings.<br>(Source: Slide 22 from <a href="https://conferences.oreilly.com/oscon/oscon2013/public/schedule/detail/29374" target="_blank" rel="noopener">Wesley Chun’s talk</a>). The <strong>intering</strong> is quite common, for example the <a href="https://en.wikipedia.org/wiki/String_interning" target="_blank" rel="noopener">string interning</a>.</p>
</li>
</ol>
<h3 id="Pythonic-object"><a href="#Pythonic-object" class="headerlink" title="Pythonic object"></a>Pythonic object</h3><ol>
<li>Difference between object representation: <code>repr()</code> and <code>str()</code>: </li>
</ol>
<ul>
<li><code>repr()</code>:<br>Return a string representing the object as the developer wants to see it.</li>
<li><code>str()</code>:<br>Return a string representing the object as the user wants to see it.</li>
</ul>
<ol start="2">
<li><p>Difference between <code>@classmethod</code> and <code>@staticmethod</code>, the former take the class (<strong>not the instance</strong>) as the first argument, so it could change the behavior based on which class is passed in; while the latter don’t have any class object as the input and it is mainly used when we want to do something only related to the specific class, regardless of what instance in the class. A good <a href="https://julien.danjou.info/guide-python-static-class-abstract-methods/" target="_blank" rel="noopener">reference artical</a> discussed the difference in detail.</p>
</li>
<li><p>How <code>format()</code> works: check here about the <a href="https://docs.python.org/3/library/string.html#formatspec" target="_blank" rel="noopener">format mini-language</a>. Then we could add custom formatting for a class by implementing <code>__format__</code> functions. </p>
</li>
</ol>
<ol start="4">
<li><p><em>Name mangling</em>: if we name a field inside a class starting with double underscore and no or one underscore the the end, Python stores the name in the instance <code>__dict__</code> prefixed with a leading underscore and the class name. Note that it is about safety, not security: it’s designed to prevent accidental access<br>and not intentional wrongdoing.</p>
</li>
<li><p>The single underscore prefix has no special meaning to the Python interpreter when used in attribute names, but it’s a very strong convention among Python programmers that you should not access such attributes from outside the class. In modules, a single <code>_</code> in front of a top-level name does have an effect: if you write from <code>mymod import *</code> the names with a <code>_</code> prefix are not imported from mymod. But you can still write from mymod <code>import _privatefunc</code>. According to <a href="https://docs.python.org/3/tutorial/modules.html#more-on-modules" target="_blank" rel="noopener">this</a>.</p>
</li>
<li><p>To define <code>__slots__</code> you create a class attribute with that name and assign it an iterable of str with identifiers for the instance attributes. The author prefers using a tuple for that, because it conveys the message that the <code>__slots__</code> definition cannot change. That will help to reduce the overhead of per-instance <code>__dict__</code>. However, here are few drawbacks:</p>
</li>
</ol>
<ul>
<li>You must remember to redeclare <code>__slots__</code> in each subclass, since the inherited attribute is ignored by the interpreter.</li>
<li>Instances will only be able to have the attributes listed in <code>__slots__</code>, unless you include ‘<code>__dict__</code>‘ in <code>__slots__</code> — but doing so may negate the memory savings.</li>
<li>Instances cannot be targets of weak references unless you remember to include ‘<code>__weakref__</code>‘ in <code>__slots__</code>.</li>
</ul>
<h3 id="Sequence-hacking-hashing-and-slicing"><a href="#Sequence-hacking-hashing-and-slicing" class="headerlink" title="Sequence hacking, hashing and slicing"></a>Sequence hacking, hashing and slicing</h3><ol>
<li><p><code>repr()</code> is conventionaly used by debugging print, so it will abbreviate if the array output has larger (&gt;6) elements. We should use <code>reprlib</code> to limit the printing length for customized class.</p>
</li>
<li><p>How slice works? The slice index become slice object:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">MySeq</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, index)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> index <span class="comment">#</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = MySeq()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>] <span class="comment">#</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>:<span class="number">4</span>] <span class="comment">#</span></span><br><span class="line">slice(<span class="number">1</span>, <span class="number">4</span>, <span class="literal">None</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>:<span class="number">4</span>:<span class="number">2</span>] <span class="comment">#</span></span><br><span class="line">slice(<span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>:<span class="number">4</span>:<span class="number">2</span>, <span class="number">9</span>] <span class="comment">#</span></span><br><span class="line">(slice(<span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>), <span class="number">9</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>:<span class="number">4</span>:<span class="number">2</span>, <span class="number">7</span>:<span class="number">9</span>] <span class="comment">#</span></span><br><span class="line">(slice(<span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>), slice(<span class="number">7</span>, <span class="number">9</span>, <span class="literal">None</span>))</span><br></pre></td></tr></table></figure>
<p>To handle better slicing, in the customized class <code>__getitem__</code> function, we should separate the logic for <code>type(index) == slice</code> and <code>numbers.Integral</code>.</p>
</li>
<li><p><code>__getattr__</code> is used to get a specifc attribute in a class. Dynamic attributes could be created using specific logic in this function. Remember to raise <code>AttributeError</code> accordingly. <code>__setattr__</code> is the corresponding setter, could used to set <strong>read only</strong> attributes, which is pretty useful in hashable object.</p>
</li>
<li><p>When using reduce it’s good practice to provide the third argument,<br><code>reduce(function, iterable, initializer)</code>, to prevent this<br>exception: <code>TypeError: reduce() of empty sequence with no
initial value</code>. </p>
</li>
</ol>
<h3 id="Interfaces-from-protocols-to-ABCs"><a href="#Interfaces-from-protocols-to-ABCs" class="headerlink" title="Interfaces: from protocols to ABCs"></a>Interfaces: from protocols to ABCs</h3><ol>
<li><p>Warning of over engineering: ABCs, like descriptors and metaclasses, are tools for building frameworks.<br>Therefore, only a very small minority of Python developers<br>can create ABCs without imposing unreasonable limitations and<br>needless work on fellow programmers.</p>
</li>
<li><p>Every class has an interface: the set public attributes (methods or data attributes) implemented or inheritedby the class. For example,<br><code>__getitem__</code> or <code>__add__</code>.</p>
</li>
<li><p><em>Monkey patching</em> is to change a class or module at runtime without touchign the source code. </p>
</li>
<li></li>
</ol>
<h2 id="Other-information"><a href="#Other-information" class="headerlink" title="Other information"></a>Other information</h2><ol>
<li><p>Python in the book: <code>CPython 3.4</code></p>
</li>
<li><p>Github: <a href="https://github.com/fluentpython" target="_blank" rel="noopener">fluentpython</a></p>
</li>
<li><p>Useful visualization of Python code running: <a href="http://www.pythontutor.com/" target="_blank" rel="noopener">pythontutor</a></p>
</li>
<li><p>use <code>dir</code> function to check the keyword of an object.</p>
</li>
<li><p>use <code>dis</code> function to get the bytecode of a python function, which could be helpful if some subtle difference comparision.</p>
</li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/04/05/MSC-shell-scripting/" rel="prev" title="[Missing Semester in CS] Shell scripting and tools">
      <i class="fa fa-chevron-left"></i> [Missing Semester in CS] Shell scripting and tools
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/04/10/MSC-editors-vim/" rel="next" title="[Missing Semester in CS] Editors (Vim)">
      [Missing Semester in CS] Editors (Vim) <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Notes"><span class="nav-number">1.</span> <span class="nav-text">Notes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Python-Data-Models"><span class="nav-number">2.</span> <span class="nav-text">Python Data Models</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Data-structures"><span class="nav-number">3.</span> <span class="nav-text">Data structures</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Array-of-sequences"><span class="nav-number">3.1.</span> <span class="nav-text">Array of sequences</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dictionaries-and-Sets"><span class="nav-number">3.2.</span> <span class="nav-text">Dictionaries and Sets</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Text-and-bytes"><span class="nav-number">3.3.</span> <span class="nav-text">Text and bytes</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Functions-as-objects"><span class="nav-number">4.</span> <span class="nav-text">Functions as objects</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Functions"><span class="nav-number">4.1.</span> <span class="nav-text">Functions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Decorators-and-closures"><span class="nav-number">4.2.</span> <span class="nav-text">Decorators and closures</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Object-Oriented-Idioms"><span class="nav-number">5.</span> <span class="nav-text">Object Oriented Idioms</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Object-references-mutability-recylcing"><span class="nav-number">5.1.</span> <span class="nav-text">Object references, mutability, recylcing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pythonic-object"><span class="nav-number">5.2.</span> <span class="nav-text">Pythonic object</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sequence-hacking-hashing-and-slicing"><span class="nav-number">5.3.</span> <span class="nav-text">Sequence hacking, hashing and slicing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Interfaces-from-protocols-to-ABCs"><span class="nav-number">5.4.</span> <span class="nav-text">Interfaces: from protocols to ABCs</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Other-information"><span class="nav-number">6.</span> <span class="nav-text">Other information</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Haicheng Wang"
      src="https://avatars1.githubusercontent.com/u/14937480?s=400&u=aa3adef3e27c09776dff1a941588ddd3888809a5&v=4">
  <p class="site-author-name" itemprop="name">Haicheng Wang</p>
  <div class="site-description" itemprop="description">Down to the earth</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hcwang95" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hcwang95" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hcwang.1995@gmail.com" title="E-Mail → mailto:hcwang.1995@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://hcwang95.github.io/resume_haicheng.pdf" title="CV → https:&#x2F;&#x2F;hcwang95.github.io&#x2F;resume_haicheng.pdf"><i class="fa fa-fw fa-CV"></i>CV</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Friend Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://zhqyvvn.github.io/" title="https:&#x2F;&#x2F;zhqyvvn.github.io&#x2F;" rel="noopener" target="_blank">zhqyvvn.github.io</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Haicheng Wang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        
<div class="busuanzi-count">
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.getAttribute('pjax') !== null) {
      script.setAttribute('pjax', '');
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '0dedffe03cd48cb95cc2',
      clientSecret: '2afb3962f782aca1cbf23b99cb9d1884f8ba9f26',
      repo        : 'hcwang95.github.io',
      owner       : 'hcwang95',
      admin       : ['hcwang95'],
      id          : 'bddfd74479d3d03732a1dcfdeabff72d',
        language: '',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

    </div>
</body>
</html>
